{% extends "base.html" %}
{% block content %}
<!-- KPIs -->
<div class="row g-2 mb-3">
  <div class="col-6 col-md-3"><div class="stat"><div class="text-muted small">Pendientes</div><div class="fs-4 fw-semibold" id="kpiPend">0</div></div></div>
  <div class="col-6 col-md-3"><div class="stat"><div class="text-muted small">Confirmadas</div><div class="fs-4 fw-semibold" id="kpiConf">0</div></div></div>
  <div class="col-6 col-md-3"><div class="stat"><div class="text-muted small">Sustituidas</div><div class="fs-4 fw-semibold" id="kpiSubs">0</div></div></div>
  <div class="col-6 col-md-3"><div class="stat"><div class="text-muted small">Canceladas</div><div class="fs-4 fw-semibold" id="kpiCanc">0</div></div></div>
</div>
<!-- Calendario de invitaciones -->
<div id="invCalendar" class="mt-4">
  <div class="row g-3">
    <!-- Calendario -->
    <div class="col-12 col-lg-7">
      <div class="card shadow-sm h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div>
            <button id="calPrev" class="btn btn-sm btn-outline-secondary me-2" title="Mes anterior">
              <i class="bi bi-chevron-left"></i>
            </button>
            <button id="calNext" class="btn btn-sm btn-outline-secondary" title="Mes siguiente">
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>
          <div class="fw-semibold" id="calTitle">‚Äî</div>
          <div></div>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0" id="calTable">
              <!-- aqu√≠ se renderiza el calendario -->
            </table>
          </div>
          <div class="small text-muted mt-2">
            ‚Ä¢ Punto indica que hay eventos ese d√≠a. Click para ver detalles ‚Üí
          </div>
        </div>
      </div>
    </div>

    <!-- Lista del d√≠a seleccionado -->
    <div class="col-12 col-lg-5">
      <div class="card shadow-sm h-100">
        <div class="card-header">
          <span class="fw-semibold">Eventos del d√≠a</span>
          <span class="text-muted ms-2" id="calSelected">‚Äî</span>
        </div>

        <!-- üëá a√±adimos clase day-list para aplicar el scroll -->
        <div class="card-body day-list" id="calDayList">
          <div class="text-muted small">Selecciona un d√≠a con eventos.</div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Panel: Eventos por persona -->
<div class="card mb-4" id="panelPersonaEventos">
  <div class="card-header d-flex align-items-center justify-content-between">
    <h5 class="mb-0"><i class="fa fa-user-check me-2"></i>Eventos por Representante de GEM</h5>
    <span class="badge bg-primary" id="ppCount">0</span>
  </div>
  <div class="card-body">
    <div class="row g-2 align-items-end">
      <div class="col-md-5">
        <label class="form-label mb-1">Buscar representante de GEM</label>
        <div class="input-group input-group-sm">
          <span class="input-group-text"><i class="fa fa-search"></i></span>
          <input id="ppBuscarNombre" class="form-control" placeholder="Nombre, cargo, unidad‚Ä¶" />
          <button id="ppRecargarPersonas" class="btn btn-outline-secondary">Buscar</button>
        </div>
        <select id="ppPersona" class="form-select form-select-sm mt-2">
          <option value="">‚Äî Selecciona ‚Äî</option>
        </select>
      </div>

      <div class="col-md-2">
        <label class="form-label mb-1">Desde</label>
        <input id="ppDesde" type="date" class="form-control form-control-sm">
      </div>
      <div class="col-md-2">
        <label class="form-label mb-1">Hasta</label>
        <input id="ppHasta" type="date" class="form-control form-control-sm">
      </div>
      <div class="col-md-2">
        <label class="form-label mb-1">Estatus</label>
        <select id="ppEstatus" class="form-select form-select-sm">
          <option value="">(Todos)</option>
          <option value="Pendiente">Pendiente</option>
          <option value="Confirmado">Confirmado</option>
        </select>
      </div>
      <div class="col-md-1 d-grid">
        <button id="ppVerEventos" class="btn btn-primary btn-sm">
          <i class="fa fa-eye me-1"></i> Ver
        </button>
      </div>
    </div>

    <div class="table-responsive mt-3">
      <table class="table table-sm table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:110px;">Fecha</th>
            <th style="width:80px;">Hora</th>
            <th>Evento</th>
            <th>Municipio</th>
            <th>Lugar</th>
            <th>Convoca</th>
            <th>Quien convoca</th>
            <th style="width:110px;">Estatus</th>
          </tr>
        </thead>
        <tbody id="ppTablaBody">
          <tr><td colspan="9" class="text-muted">Sin datos‚Ä¶</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div class="toolbar border rounded-3 p-2 p-md-3 bg-body-tertiary mb-3">
  <div class="d-flex flex-wrap align-items-center gap-2">

    <!-- Filtro por estatus -->
    <div class="btn-group btn-group-sm" role="group" aria-label="Filtros" id="statusBtns">
      <button class="btn btn-outline-secondary active" data-status="">
        <i class="bi bi-list-ul me-1"></i> Todas
      </button>
      <button class="btn btn-outline-secondary" data-status="Pendiente">
        <i class="bi bi-hourglass-split me-1"></i> Pendientes
      </button>
      <button class="btn btn-outline-secondary" data-status="Confirmado">
        <i class="bi bi-check2-circle me-1"></i> Confirmadas
      </button>
      <button class="btn btn-outline-secondary" data-status="Sustituido">
        <i class="bi bi-arrow-left-right me-1"></i> Sustituidas
      </button>
      <button class="btn btn-outline-secondary" data-status="Cancelado">
        <i class="bi bi-x-circle me-1"></i> Canceladas
      </button>
    </div>

    <div class="vr d-none d-md-inline mx-1"></div>

    <!-- Rango de fechas + municipio -->
    <div class="d-flex align-items-end gap-2 flex-wrap">
      <div class="input-group input-group-sm" style="width: 13rem;">
        <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
        <input type="date" id="fDesde" class="form-control" aria-label="Desde">
      </div>
      <div class="input-group input-group-sm" style="width: 13rem;">
        <span class="input-group-text"><i class="bi bi-calendar-range"></i></span>
        <input type="date" id="fHasta" class="form-control" aria-label="Hasta">
      </div>
      <div class="input-group input-group-sm" style="width: 18rem;">
        <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
        <select id="fMuni" class="form-select">
          <option value="">Todos los municipios</option>
        </select>
      </div>
      <button id="btnFiltrarFechas" type="button" class="btn btn-sm btn-outline-primary">
        <i class="bi bi-funnel me-1"></i> Aplicar
      </button>
      <button id="btnLimpiarFechas" type="button" class="btn btn-sm btn-link">
        Limpiar
      </button>
    </div>

    <!-- Acciones -->
    <div class="ms-auto d-flex flex-wrap gap-2">
      <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalNewPersona" type="button" data-roles="admin">
        <i class="bi bi-person-plus me-1"></i> Representante GEM
      </button>
      <button class="btn btn-dark btn-sm" data-bs-toggle="modal" data-bs-target="#modalNewActor" type="button" data-roles="admin">
        <i class="bi bi-person-gear me-1"></i> PM
      </button>
      <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalCreate" type="button" data-roles="admin">
        <i class="bi bi-plus-lg me-1"></i> Nueva invitaci√≥n
      </button>
      <button id="btnExportXlsx" class="btn btn-outline-success btn-sm" type="button" data-roles="admin,viewer">
        <i class="bi bi-file-earmark-spreadsheet me-1"></i> Exportar XLSX
      </button>
    </div>

  </div>
</div>

<!-- ===== Panel por categor√≠a (Bootstrap Tabs) ===== -->
<ul class="nav nav-tabs mb-3" id="tabsConvoca" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active d-flex align-items-center gap-2"
            id="tab-dip-tab" data-bs-toggle="tab" data-bs-target="#tab-dip"
            type="button" role="tab" aria-controls="tab-dip" aria-selected="true">
      Diputaciones <span id="cntDip" class="badge rounded-pill bg-secondary">0</span>
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link d-flex align-items-center gap-2"
            id="tab-pres-tab" data-bs-toggle="tab" data-bs-target="#tab-pres"
            type="button" role="tab" aria-controls="tab-pres" aria-selected="false">
      Presidencia <span id="cntPres" class="badge rounded-pill bg-secondary">0</span>
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link d-flex align-items-center gap-2"
            id="tab-otros-tab" data-bs-toggle="tab" data-bs-target="#tab-otros"
            type="button" role="tab" aria-controls="tab-otros" aria-selected="false">
      Otros <span id="cntOtros" class="badge rounded-pill bg-secondary">0</span>
    </button>
  </li>
</ul>

<div class="tab-content" id="tabsConvocaContent">
  <div class="tab-pane fade show active" id="tab-dip" role="tabpanel" aria-labelledby="tab-dip-tab" tabindex="0">
    <div id="groupDip" class="row g-3"></div>
  </div>
  <div class="tab-pane fade" id="tab-pres" role="tabpanel" aria-labelledby="tab-pres-tab" tabindex="0">
    <div id="groupPres" class="row g-3"></div>
  </div>
  <div class="tab-pane fade" id="tab-otros" role="tabpanel" aria-labelledby="tab-otros-tab" tabindex="0">
    <div id="groupOtros" class="row g-3"></div>
  </div>
</div>

<!-- =====================
     Modal: Gestionar / Asignar Representante
====================== -->
<div class="modal fade" id="modalAssign" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg">

      <!-- HEADER -->
      <div class="modal-header border-0 border-bottom">
        <div class="d-flex align-items-center gap-2">
          <span class="badge rounded-pill bg-primary-subtle text-primary-emphasis">
            <i class="bi bi-people-fill me-1"></i> Designaci√≥n
          </span>
          <div class="d-flex flex-column">
            <h5 class="modal-title mb-0 fw-semibold">Designar representante de GEM</h5>
            <small id="assignMeta" class="text-muted"> <!-- JS llenar√°: Evento ¬∑ Fecha ¬∑ Hora ¬∑ Municipio --> </small>
          </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body bg-light-subtle">

        <!-- TABS -->
        <ul class="nav nav-tabs small mb-3" id="assignTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active"
                    id="tab-general-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tabAsignGeneral"
                    type="button"
                    role="tab"
                    aria-controls="tabAsignGeneral"
                    aria-selected="true">
              <i class="bi bi-person-check me-1"></i> Asignaci√≥n general
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="tab-region-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tabAsignRegion"
                    type="button"
                    role="tab"
                    aria-controls="tabAsignRegion"
                    aria-selected="false">
              <i class="bi bi-geo-alt me-1"></i> Asignaci√≥n por regi√≥n
            </button>
          </li>
        </ul>

        <div class="tab-content">

          <!-- TAB 1: ASIGNACI√ìN GENERAL -->
          <div class="tab-pane fade show active" id="tabAsignGeneral" role="tabpanel" aria-labelledby="tab-general-tab">
            <div class="row g-3">
              <!-- Columna principal -->
              <div class="col-12 col-lg-7">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-header bg-white py-2 d-flex justify-content-between align-items-center">
                    <div>
                      <span class="small text-uppercase text-muted">Representante</span>
                      <div class="fw-semibold small">Asignaci√≥n directa</div>
                    </div>
                    <span class="badge bg-primary-subtle text-primary-emphasis">
                      <i class="bi bi-lightning-charge-fill me-1"></i> Flujo normal
                    </span>
                  </div>

                  <div class="card-body p-3">
                    <!-- PERSONA (TomSelect se inicializa sobre este select) -->
                    <div class="mb-3">
                      <label class="form-label fw-semibold small">Representante de GEM</label>
                      <select id="selPersona" class="form-select" aria-label="Seleccionar representante">
                        <option value="">‚Äî Sin asignar ‚Äî</option>
                      </select>
                      <div class="form-text small">Elige a la persona que asistir√° en representaci√≥n del GEM.</div>
                    </div>

                    <!-- Ficha de la persona seleccionada -->
                    <div id="personaInfo" class="border rounded-3 p-2 mb-3 bg-body-tertiary small">
                      <div class="text-muted">Selecciona un representante para ver su informaci√≥n.</div>
                    </div>

                    <!-- ROL (cargo) -->
                    <div class="mb-3">
                      <label class="form-label fw-semibold small">Cargo</label>
                      <input id="inpRol" class="form-control form-control-sm" placeholder="Cargo" disabled>
                      <div class="form-text small">Se llena autom√°ticamente con el cargo de la persona.</div>
                    </div>

                    <!-- COMENTARIO -->
                    <div class="mb-0">
                      <label class="form-label fw-semibold small">Comentario / Nota interna</label>
                      <textarea id="inpComentario" class="form-control form-control-sm" rows="2"
                                placeholder="Ej. Ajuste de agenda, condiciones especiales, etc."></textarea>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Columna lateral: acciones sobre la persona -->
              <div class="col-12 col-lg-5">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-header bg-white py-2">
                    <span class="small text-uppercase text-muted">Acciones</span>
                    <div class="fw-semibold small">Gesti√≥n del representante</div>
                  </div>
                  <div class="card-body p-3 d-flex flex-column gap-2">
                    <button id="btnEditPersonaInline" type="button"
                            class="btn btn-sm btn-outline-primary w-100 text-start d-flex align-items-center justify-content-between"
                            disabled>
                      <span><i class="bi bi-pencil-square me-2"></i>Editar representante</span>
                      <i class="bi bi-chevron-right small"></i>
                    </button>

                    <button id="btnDeletePersonaInline" type="button"
                            class="btn btn-sm btn-outline-danger w-100 text-start d-flex align-items-center justify-content-between"
                            disabled>
                      <span><i class="bi bi-trash3 me-2"></i>Eliminar representante</span>
                      <i class="bi bi-exclamation-triangle-fill small"></i>
                    </button>

                    <div class="border-top mt-2 pt-2 small text-muted">
                      Estas acciones afectan solamente al cat√°logo de personas, no a la invitaci√≥n hist√≥rica.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- TAB 2: ASIGNACI√ìN POR REGI√ìN -->
          <div class="tab-pane fade" id="tabAsignRegion" role="tabpanel" aria-labelledby="tab-region-tab">
            <div class="row g-3">
              <!-- IZQUIERDA: MAPA + REGI√ìN -->
              <div class="col-12 col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-header bg-white py-2 d-flex justify-content-between align-items-center">
                    <div>
                      <span class="small text-uppercase text-muted">Mapa</span>
                      <div class="fw-semibold small">Cobertura por regi√≥n</div>
                    </div>
                    <span class="badge bg-success-subtle text-success-emphasis small">
                      <i class="bi bi-map-fill me-1"></i> Vista territorial
                    </span>
                  </div>

                  <div class="card-body p-3">
                    <!-- Select de regi√≥n -->
                    <div class="mb-2">
                      <label class="form-label fw-semibold small">Regi√≥n</label>
                      <div class="d-flex gap-2 align-items-center">
                        <select id="regRegion" class="form-select form-select-sm" aria-label="Seleccionar regi√≥n">
                          <option value="">‚Äî Seleccione regi√≥n ‚Äî</option>
                          <!-- Llenar por JS -->
                        </select>
                        <!-- peque√±o spinner para indicar carga de personas/regi√≥n -->
                        <div id="regLoading" class="spinner-border spinner-border-sm text-muted d-none" role="status" aria-hidden="true"></div>
                      </div>
                      <div class="form-text small">Filtra municipios y personas seg√∫n la regi√≥n.</div>
                    </div>

                    <!-- Contenedor mapa Leaflet -->
                    <div id="regMap" class="rounded-3 border" style="height: 300px; background:#f8f9fa;">
                      <!-- Map (Leaflet) se inicializa desde initAssignRegionModule / bootstrapRegionCache -->
                    </div>

                    <!-- Info de regi√≥n -->
                    <div id="regRegionInfo" class="small mt-2 text-muted">Selecciona una regi√≥n para ver sus municipios.</div>
                  </div>
                </div>
              </div>

              <!-- DERECHA: PERSONA POR REGI√ìN -->
              <div class="col-12 col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                  <div class="card-header bg-white py-2 d-flex justify-content-between align-items-center">
                    <div>
                      <span class="small text-uppercase text-muted">Representante sugerido</span>
                      <div class="fw-semibold small">Por regi√≥n</div>
                    </div>
                    <span class="badge bg-info-subtle text-info-emphasis small">
                      <i class="bi bi-compass me-1"></i> Sugerencias
                    </span>
                  </div>

                  <div class="card-body p-3 d-flex flex-column gap-2">
                    <div>
                      <label class="form-label fw-semibold small">Representante (seg√∫n regi√≥n)</label>
                      <select id="regPersona" class="form-select form-select-sm" aria-label="Representante por regi√≥n">
                        <option value="">‚Äî Seleccione ‚Äî</option>
                        <!-- Llenar por JS -->
                      </select>
                      <div class="form-text small">Se muestran solo las personas asociadas a la regi√≥n seleccionada.</div>
                    </div>

                    <!-- Ficha detalle de la persona de regi√≥n -->
                    <div id="regionPersonaInfo" class="border rounded-3 p-2 bg-body-tertiary small">
                      <div class="text-muted">Selecciona una persona para ver su regi√≥n, municipios y datos de contacto.</div>
                    </div>

                    <div class="border-top pt-2 small text-muted">
                      Al usar esta persona, se copiar√° autom√°ticamente a la pesta√±a <b>‚ÄúAsignaci√≥n general‚Äù</b> y podr√°s guardar normalmente.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div> <!-- fin TAB 2 -->

        </div> <!-- .tab-content -->

        <!-- Mensajes de error del guardado -->
        <div id="assignMsg" class="alert alert-danger d-none small mt-3 mb-0"></div>

      </div> <!-- modal-body -->

      <!-- FOOTER -->
      <div class="modal-footer border-0 border-top bg-white">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button id="btnAsignarGuardar" class="btn btn-primary">
          <i class="bi bi-save me-1"></i> Guardar designaci√≥n
        </button>
      </div>
    </div>
  </div>
</div>



<!-- =========================
     Modal: Crear invitaci√≥n
========================== -->
<div class="modal fade" id="modalCreate" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Nueva invitaci√≥n</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>

    <div class="modal-body">
      <div class="row g-2">
        <div class="col-6">
          <label class="form-label">Fecha</label>
          <input id="cFecha" type="date" class="form-control">
        </div>
        <div class="col-6">
          <label class="form-label">Hora</label>
          <input id="cHora" type="time" class="form-control">
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <label class="form-label">Evento</label>
          <select id="cEvento" class="form-select">
            <option value="">-- Seleccione --</option>
            <option>Primer Informe en Cabildo</option>
            <option>Primer Informe al P√∫blico</option>
            <option>Primer Informe en Cabildo y al P√∫blico</option>
          </select>
        </div>
                  <!-- Sub-tipo (se rellena autom√°ticamente) -->
          <div class="col-6 mt-2">
            <label class="form-label">Tipo de evento</label>
            <select id="cSubTipo" class="form-select">
              <option value="">‚Äî</option>
              <option value="pre">Pre (Cabildo)</option>
              <option value="publico">P√∫blico</option>
              <option value="mixto">Mixto</option>
            </select>
          </div>

      </div>    
      <div class="mt-2">
        <label class="form-label">Quien Convoca</label>
        <select id="cConvocaCargo" class="form-select">
          <option value="">-- Seleccione --</option>
          <option>Diputadas y Diputados</option>
          <option>Presidentas y Presidentes Municipales</option>
        </select>
      </div>

      <div class="mt-2">
        <label class="form-label">Partido Pol√≠tico</label>
        <select id="cPartido" class="form-select">
          <option value="">-- Seleccione partido --</option>
        </select>
      </div>

      <div class="row g-2 mt-2">
        <div class="col-6">
          <label class="form-label">Municipio</label>
          <select id="cMuni" class="form-select" required>
            <option value="">Selecciona...</option>
          </select>
        </div>
        <div class="col-6">
          <label class="form-label">Lugar del Evento</label>
          <input id="cLugar" class="form-control">
        </div>
      </div>

      <hr class="my-3">
      <div class="form-text mb-1">Selecciona el <b>PM</b> que convoca (obligatorio).</div>
      <div>
        <label class="form-label">PM</label>
        <select id="cActor" class="form-select">
          <option value="">‚Äî</option>
        </select>
      </div>

<!-- Vincular a grupo -->
          <div class="col-12 mt-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="cVincular">
              <label class="form-check-label" for="cVincular">
                Vincular esta invitaci√≥n a un grupo (pre / p√∫blico / mixto)
              </label>
            </div>
          </div>

          <div class="col-12 mt-2" id="cGrupoRow" style="display:none;">
            <label class="form-label">Identificador de grupo</label>
            <input id="cGrupoToken" class="form-control" placeholder="Ej. GRP-TOLUCA-01">
            <div class="form-text">
              Usa el mismo identificador para vincular pre + p√∫blico. Si lo dejas vac√≠o, se generar√° uno autom√°tico.
            </div>
          </div>

      <div class="mt-2">
        <label class="form-label">Archivo</label>
        <input id="cArchivo" type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
        <div id="filePreview" class="small text-muted mt-1"></div>
      </div>

      <div class="mt-2">
        <label class="form-label">Observaciones</label>
        <textarea id="cObs" class="form-control" rows="2"></textarea>
      </div>

      <div id="cMsg" class="alert alert-danger small d-none mt-2"></div>
    </div>

    <div class="modal-footer">
      <button id="btnCrear" type="button" class="btn btn-primary">Crear</button>
    </div>
  </div></div>
</div>

<!-- Modal: Eventos vinculados (grupo) -->
<div class="modal fade" id="modalGrupo" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="grupoTitle">Eventos vinculados</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" id="grupoBody">
        <div class="text-muted small">Sin datos de grupo.</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>
<!-- =========================
     Modal: Editar invitaci√≥n
========================= -->
<div class="modal fade" id="modalEdit" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Editar invitaci√≥n</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>

    <div class="modal-body">
      <input type="hidden" id="eId">

      <div class="row g-2">
        <div class="col-6">
          <label class="form-label">Fecha</label>
          <input id="eFecha" type="date" class="form-control">
        </div>
        <div class="col-6">
          <label class="form-label">Hora</label>
          <input id="eHora" type="time" class="form-control">
        </div>
      </div>

      <div class="mt-2">
        <label class="form-label">Evento</label>
        <select id="eEvento" class="form-select">
          <option value="">-- Seleccione --</option>
          <option>Primer Informe en Cabildo</option>
          <option>Primer Informe al P√∫blico</option>
          <option>Primer Informe en Cabildo y al P√∫blico</option>
        </select>
      </div>

      <div class="mt-2">
        <label class="form-label">Qui√©n convoca</label>
        <select id="eConvocaCargo" class="form-select">
          <option value="">-- Seleccione --</option>
          <option>Diputadas y Diputados</option>
          <option>Presidentas y Presidentes Municipales</option>
        </select>
      </div>

      <div class="mt-2">
        <label class="form-label">Partido Pol√≠tico</label>
        <select id="ePartido" class="form-select">
          <option value="">-- Seleccione partido --</option>
        </select>
      </div>

      <div class="row g-2 mt-2">
        <div class="col-6">
          <label class="form-label">Municipio</label>
          <select id="eMuni" class="form-select" required>
            <option value="">Selecciona...</option>
          </select>
        </div>
        <div class="col-6">
          <label class="form-label">Lugar del Evento</label>
          <input id="eLugar" class="form-control">
        </div>
      </div>

      <div class="mt-2">
        <label class="form-label">Observaciones</label>
        <textarea id="eObs" class="form-control" rows="2"></textarea>
      </div>

      <div class="mt-2">
        <label class="form-label">Archivo</label>
        <input id="eArchivo" type="file" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
        <div id="eFilePreview" class="small text-muted mt-1"></div>
        <div class="d-flex gap-2 mt-1">
          <a id="eFileLink" href="#" target="_blank" class="small d-none">Ver archivo actual</a>
          <button id="eBtnFileRemove" type="button" class="btn btn-sm btn-outline-danger d-none">Quitar archivo</button>
        </div>
      </div>

      <div id="eMsg" class="alert alert-danger small d-none mt-2"></div>
    </div>

    <div class="modal-footer">
      <button id="btnEditarGuardar" class="btn btn-primary">
        Guardar cambios
      </button>
    </div>
  </div></div>
</div>

<!-- =========================
     Modal: Editar persona
========================= -->
<div class="modal fade" id="modalEditPersona" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Editar Representante de GEM</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>

    <div class="modal-body">
      <input type="hidden" id="epID">

      <!-- Regi√≥n (opcional) -->
      <div class="mb-2">
        <label class="form-label">Regi√≥n (opcional)</label>
        <select id="epRegion" class="form-select">
          <option value="">‚Äî Ninguna ‚Äî</option>
          <!-- Se llenar√° via loadRegiones() -->
        </select>
      </div>

      <div class="mb-2">
        <label class="form-label">Nombre</label>
        <input id="epNombre" class="form-control" placeholder="Nombre completo">
      </div>

      <div class="mb-2">
        <label class="form-label">Cargo</label>
        <input id="epCargo" class="form-control" placeholder="Cargo/rol">
      </div>

      <div class="row g-2">
        <div class="col-6">
          <label class="form-label">Tel√©fono (10 d√≠gitos)</label>
          <input id="epTelefono" class="form-control" maxlength="10" inputmode="numeric">
        </div>
        <div class="col-6">
          <label class="form-label">Correo</label>
          <input id="epCorreo" type="email" class="form-control">
        </div>
      </div>

      <div class="mt-2">
        <label class="form-label">Unidad/√Årea/Secretar√≠a</label>
        <input id="epUnidad" class="form-control" placeholder="Unidad o regi√≥n">
      </div>

      <div class="row g-2 mt-2">
        <div class="col-6">
          <label class="form-label">Sexo</label>
          <select id="epSexo" class="form-select">
            <option value="">‚Äî</option>
            <!-- Se llena con loadSexos() -->
          </select>
        </div>
        <div class="col-6 d-flex align-items-end">
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" id="epActivo">
            <label class="form-check-label" for="epActivo">Activo</label>
          </div>
        </div>
      </div>

      <hr class="my-3">
      <div class="small text-muted mb-1">Particular (obligatorio)</div>

      <div class="row g-2">
        <div class="col-4">
          <label class="form-label">Nombre</label>
          <input id="epPartNombre" class="form-control">
        </div>
        <div class="col-4">
          <label class="form-label">Cargo</label>
          <input id="epPartCargo" class="form-control">
        </div>
        <div class="col-4">
          <label class="form-label">Tel√©fono</label>
          <input id="epPartTel" class="form-control" maxlength="10" inputmode="numeric">
        </div>
      </div>

      <div id="epMsg" class="alert alert-danger small d-none mt-2"></div>
    </div>

    <div class="modal-footer">
      <button id="btnGuardarEditPersona" class="btn btn-primary">Guardar cambios</button>
    </div>
  </div></div>
</div>

<!-- =========================
     Modal: Eliminar persona
========================= -->
<div class="modal fade" id="modalDeletePersona" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Eliminar Representante de GEM</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>

    <div class="modal-body">
      <div class="mb-2">
        ¬øEliminar a <b id="delPersonaName">‚Äî</b>?
        <input type="hidden" id="delPersonaId">
      </div>
      <div class="alert alert-warning small">
        Esta acci√≥n es definitiva. Si est√° asignada a invitaciones, se desasignar√°.
      </div>
      <div id="delPersonaMsg" class="alert alert-danger small d-none"></div>
    </div>

    <div class="modal-footer">
      <button id="btnEliminarPersonaConfirm" class="btn btn-danger">Eliminar</button>
    </div>
  </div></div>
</div>

<!-- =========================
     Modal: Nueva persona
========================= -->
<div class="modal fade" id="modalNewPersona" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Agregar Representante de GEM</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>

    <div class="modal-body">
      <div id="npMsg" class="alert alert-danger d-none small mb-2"></div>

      <div class="row g-2">
        <!-- Regi√≥n (opcional) - agregar dentro de modalNewPersona -->
        <div class="mt-2">
          <label class="form-label">Regi√≥n (opcional)</label>
          <select id="npRegion" class="form-select">
            <option value="">‚Äî Ninguna ‚Äî</option>
            <!-- se llenar√° v√≠a JS -->
          </select>
        </div>
        <div class="col-md-7">
          <label class="form-label">Nombre *</label>
          <input id="npNombre" class="form-control" autocomplete="off">
        </div>
        <div class="col-md-5">
          <label class="form-label">Sexo</label>
          <select id="npSexo" class="form-select">
            <option value="">‚Äî</option>
            <!-- se llena v√≠a loadSexos() -->
          </select>
        </div>
      </div>

      <div class="mt-2">
        <label class="form-label">Cargo *</label>
        <input id="npCargo" class="form-control" autocomplete="off">
      </div>

      <div class="row g-2 mt-2">
        <div class="col-md-6">
          <label class="form-label">Tel√©fono (10 d√≠gitos)</label>
          <input id="npTelefono" class="form-control" inputmode="numeric" autocomplete="off">
        </div>
        <div class="col-md-6">
          <label class="form-label">Correo</label>
          <input id="npCorreo" type="email" class="form-control" autocomplete="off">
        </div>
      </div>

      <div class="mt-2">
        <label class="form-label">Unidad/Secretar√≠a</label>
        <input id="npUnidad" class="form-control" autocomplete="off">
      </div>

      <hr class="my-3">

      <div class="fw-semibold mb-1">Contacto particular (obligatorio)</div>
      <div class="row g-2">
        <div class="col-md-6">
          <label class="form-label">Nombre</label>
          <input id="npPartNombre" class="form-control" autocomplete="off">
        </div>
        <div class="col-md-6">
          <label class="form-label">Cargo</label>
          <input id="npPartCargo" class="form-control" autocomplete="off">
        </div>
      </div>

      <div class="mt-2">
        <label class="form-label">Tel√©fono particular</label>
        <input id="npPartTel" class="form-control" inputmode="numeric" autocomplete="off">
      </div>
    </div>

    <div class="modal-footer">
      <button id="btnGuardarPersona" class="btn btn-primary">
        Guardar
      </button>
    </div>
  </div></div>
</div>


<!-- ===================
     Modal: Nuevo Actor
==================== -->
<div class="modal fade" id="modalNewActor" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Agregar PM</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="modal-body">
      <div class="mb-2">
        <label class="form-label">Nombre</label>
        <input id="naNombre" class="form-control" required>
      </div>
      <div class="mb-2">
        <label class="form-label">Cargo</label>
        <input id="naCargo" class="form-control">
      </div>
      <div class="mb-2">
        <label class="form-label">Tel√©fono</label>
        <input id="naTelefono" class="form-control" placeholder="10 d√≠gitos">
      </div>
      <div class="mb-2">
        <label class="form-label">Sexo</label>
        <select id="naSexo" class="form-select">
          <option value="">‚Äî</option>
        </select>
      </div>

      <div class="mt-2 form-text">Datos del particular(Obligatorio)</div>
      <div class="row g-2">
        <div class="col-4"><input id="naPartNombre" class="form-control" placeholder="Nombre"></div>
        <div class="col-4"><input id="naPartCargo" class="form-control" placeholder="Cargo"></div>
        <div class="col-4"><input id="naPartTel" class="form-control" placeholder="Tel√©fono"></div>
      </div>
    </div>
  <div class="modal-footer">
    <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
    <div class="ms-auto d-flex gap-2">
      <button id="btnOpenEditActor" class="btn btn-outline-primary">Editar PM</button>
      <button id="btnOpenDeleteActor" class="btn btn-outline-danger">Eliminar PM</button>
      <button id="btnGuardarActor" class="btn btn-dark">Guardar</button>
    </div>
  </div>
  </div></div>
</div>

<!-- ===================
     Modal: Editar Actor
==================== -->
<div class="modal fade" id="modalEditActor" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Editar PM</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>

    <div class="modal-body">
      <div class="mb-2">
        <label class="form-label">Selecciona PM</label>
        <select id="eaActorSel" class="form-select">
          <option value="">‚Äî</option>
        </select>
      </div>

      <hr class="text-muted">

      <div class="mb-2">
        <label class="form-label">Nombre</label>
        <input id="eaNombre" class="form-control">
      </div>
      <div class="mb-2">
        <label class="form-label">Cargo</label>
        <input id="eaCargo" class="form-control">
      </div>
      <div class="mb-2">
        <label class="form-label">Tel√©fono</label>
        <input id="eaTelefono" class="form-control" placeholder="10 d√≠gitos">
      </div>
      <div class="mb-2">
        <label class="form-label">Sexo</label>
        <select id="eaSexo" class="form-select">
          <option value="">‚Äî</option>
        </select>
      </div>

      <div class="mt-2 form-text">Datos del particular (Obligatorio)</div>
      <div class="row g-2">
        <div class="col-4"><input id="eaPartNombre" class="form-control" placeholder="Nombre"></div>
        <div class="col-4"><input id="eaPartCargo" class="form-control" placeholder="Cargo"></div>
        <div class="col-4"><input id="eaPartTel" class="form-control" placeholder="Tel√©fono"></div>
      </div>

      <div id="eaMsg" class="alert alert-danger d-none mt-3"></div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
      <button id="btnActorUpdate" class="btn btn-primary">Guardar cambios</button>
    </div>
  </div></div>
</div>
<!-- ===================
     Modal: Eliminar Actor
==================== -->
<div class="modal fade" id="modalDeleteActor" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Eliminar PM</h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>

    <div class="modal-body">
      <div class="mb-2">
        <label class="form-label">Selecciona PM</label>
        <select id="daActorSel" class="form-select">
          <option value="">‚Äî</option>
        </select>
      </div>
      <div class="alert alert-warning small">
        Esta acci√≥n <b>no se puede deshacer</b>. Si el PM est√° vinculado a invitaciones hist√≥ricas, considera implementar borrado l√≥gico.
      </div>
      <div id="daMsg" class="alert alert-danger d-none"></div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
      <button id="btnActorDeleteConfirm" class="btn btn-danger">Eliminar</button>
    </div>
  </div></div>
</div>
{% endblock %}
